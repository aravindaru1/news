<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Display Images</title>
  <style>
    .image-container {
      position: relative;
      /* Set the initial size for the container */
      width: 1600px; /* Adjust as per level2 width */
      height: 2743px; /* Adjust as per level2 height */
    }
    .image-chunk {
      position: absolute;
    }
    .btn {
      position: absolute;
      top: 100%;
      padding: 20px;
      width: 100%;
      display: flex;
      justify-content: space-around;
    }
    button {
      width: 200px;
      height: 200px;
      background-color: transparent;
      color: black;
      font-size: 9em;
      border: transparent;
      outline: transparent;
    }
    .index-input {
      position: fixed; /* Changed from absolute to fixed */
      top: 10px;
      right: 30px;
      font-size: 3em; /* Adjusted the font size */
      padding: 10px;
      width: 500px;
      height: 80px; /* Adjusted the width */
      border: 1px solid black; /* Added border */
      outline: none;
    }
    .index-display {
      position: fixed; /* Changed from absolute to fixed */
      top: 10px;
      left: 10px;
      font-size: 5em; /* Adjusted the font size */
    }
    .bottom-navbar {
      position: fixed;
      bottom: 0;
      width: 100%;
      background-color: #f0f0f0;
      display: flex;
      justify-content: space-around;
      padding: 20px 0;
    }
    .bottom-navbar button {
      font-size: 2em;
      padding: 10px 20px;
    }
  </style>
</head>
<body>
  <div class="image-container" id="imageContainer"></div>
  <div class="btn">
    <!-- Remove < > buttons -->
  </div>
  <input type="number" id="indexInput" class="index-input" min="1" placeholder="Go to Page No">
  <div id="indexDisplay" class="index-display"></div>
  
  <!-- Fixed bottom navbar -->
  <div class="bottom-navbar" id="bottomNavbar"></div>

  <script>
    let currentLevelIndex = 1; // Initial level index
    let totalPages = 0; // Variable to store total pages dynamically

    document.addEventListener("DOMContentLoaded", function() {
      fetchLevelData(currentLevelIndex);
    });

    function fetchLevelData(levelIndex) {
      fetch('/fetch_scraped_data') // Fetch data from the Django view
        .then(response => {
          if (!response.ok) {
            throw new Error('Network response was not ok');
          }
          return response.json();
        })
        .then(data => {
          totalPages = Object.keys(data).length; // Update total pages dynamically
          displayLevel(data, levelIndex);
          updateIndexDisplay(levelIndex);
          updateBottomNavbar();
        })
        .catch(error => console.error('Error fetching data:', error));
    }

    function displayLevel(data, levelIndex) {
      const levelKey = `${levelIndex}`;
      const level = data[levelKey].levels["level2"];
      const container = document.getElementById('imageContainer');
      container.style.width = `${level.width}px`;
      container.style.height = `${level.height}px`;
      container.innerHTML = ''; // Clear previous images

      level.chunks.forEach(chunk => {
        const img = document.createElement('img');
        img.src = chunk.url;
        img.style.left = `${chunk.tx}px`;
        img.style.top = `${chunk.ty}px`;
        img.style.width = `${chunk.width}px`;
        img.style.height = `${chunk.height}px`;
        img.classList.add('image-chunk');
        container.appendChild(img);
      });
    }

    function updateIndexDisplay(currentIndex) {
      const indexDisplay = document.getElementById('indexDisplay');
      indexDisplay.textContent = `${currentIndex}/${totalPages}`;
    }

    function updateBottomNavbar() {
      const bottomNavbar = document.getElementById('bottomNavbar');
      bottomNavbar.innerHTML = ''; // Clear previous buttons

      const prevButton = document.createElement('button');
      prevButton.textContent = 'Prev';
      prevButton.addEventListener('click', () => {
        currentLevelIndex--;
        if (currentLevelIndex < 1) {
          currentLevelIndex = totalPages; // Cycle back to the last page when reaching the first page
        }
        fetchLevelData(currentLevelIndex);
      });
      bottomNavbar.appendChild(prevButton);

      const nextButton = document.createElement('button');
      nextButton.textContent = 'Next';
      nextButton.addEventListener('click', () => {
        currentLevelIndex++;
        if (currentLevelIndex > totalPages) {
          currentLevelIndex = 1; // Cycle back to the first page when reaching the last page
        }
        fetchLevelData(currentLevelIndex);
      });
      bottomNavbar.appendChild(nextButton);
    }

    // Event listener for the index input field
    const indexInput = document.getElementById('indexInput');
    indexInput.addEventListener('change', function() {
      const newIndex = parseInt(indexInput.value);
      if (newIndex >= 1 && newIndex <= totalPages) {
        currentLevelIndex = newIndex;
        fetchLevelData(currentLevelIndex);
      } else {
        alert(`Please enter a valid index between 1 and ${totalPages}.`);
        indexInput.value = currentLevelIndex; // Reset to current index if invalid input
      }
    });
  </script>
</body>
</html>
